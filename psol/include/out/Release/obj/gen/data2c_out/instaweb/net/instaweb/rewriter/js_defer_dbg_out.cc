// Copyright 2011 Google Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// Automatically generated from /usr/src/modpagespeed/out/Release/obj/gen/closure_out/instaweb/rewriter/js_defer_dbg.js

namespace net_instaweb {

const char* JS_js_defer =
    "(function(){var pagespeedutils = {MAX_POST_SIZE:131072, send"
    "Beacon:function(a, b, d) {\n  var c;\n  if (window.XMLHttpRequ"
    "est) {\n    c = new XMLHttpRequest;\n  } else {\n    if (window"
    ".ActiveXObject) {\n      try {\n        c = new ActiveXObject("
    "\"Msxml2.XMLHTTP\");\n      } catch (e) {\n        try {\n       "
    "   c = new ActiveXObject(\"Microsoft.XMLHTTP\");\n        } cat"
    "ch (f) {\n        }\n      }\n    }\n  }\n  if (!c) {\n    return "
    "!1;\n  }\n  var g = -1 == a.indexOf(\"?\") ? \"?\" : \"&\";\n  a = a "
    "+ g + \"url=\" + encodeURIComponent(b);\n  c.open(\"POST\", a);\n "
    " c.setRequestHeader(\"Content-Type\", \"application/x-www-form-"
    "urlencoded\");\n  c.send(d);\n  return !0;\n}, addHandler:functi"
    "on(a, b, d) {\n  if (a.addEventListener) {\n    a.addEventList"
    "ener(b, d, !1);\n  } else {\n    if (a.attachEvent) {\n      a."
    "attachEvent(\"on\" + b, d);\n    } else {\n      var c = a[\"on\" "
    "+ b];\n      a[\"on\" + b] = function() {\n        d.call(this);"
    "\n        c && c.call(this);\n      };\n    }\n  }\n}, getPositio"
    "n:function(a) {\n  for (var b = a.offsetTop, d = a.offsetLeft"
    ";a.offsetParent;) {\n    a = a.offsetParent, b += a.offsetTop"
    ", d += a.offsetLeft;\n  }\n  return {top:b, left:d};\n}, getWin"
    "dowSize:function() {\n  return {height:window.innerHeight || "
    "document.documentElement.clientHeight || document.body.clien"
    "tHeight, width:window.innerWidth || document.documentElement"
    ".clientWidth || document.body.clientWidth};\n}, inViewport:fu"
    "nction(a, b) {\n  var d = pagespeedutils.getPosition(a);\n  re"
    "turn pagespeedutils.positionInViewport(d, b);\n}, positionInV"
    "iewport:function(a, b) {\n  return a.top < b.height && a.left"
    " < b.width;\n}, getRequestAnimationFrame:function() {\n  retur"
    "n window.requestAnimationFrame || window.webkitRequestAnimat"
    "ionFrame || window.mozRequestAnimationFrame || window.oReque"
    "stAnimationFrame || window.msRequestAnimationFrame || null;\n"
    "}};\npagespeedutils.now = Date.now || function() {\n  return +"
    "new Date;\n};\nwindow.pagespeed = window.pagespeed || {};\nvar "
    "pagespeed = window.pagespeed;\npagespeed.deferJsNs = {};\nvar "
    "deferJsNs = pagespeed.deferJsNs;\ndeferJsNs.DeferJs = functio"
    "n() {\n  this.queue_ = [];\n  this.logs = [];\n  this.dynamicIn"
    "sertedScriptCount_ = this.next_ = 0;\n  this.dynamicInsertedS"
    "cript_ = [];\n  this.documentWriteHtml_ = \"\";\n  this.eventLis"
    "tenersMap_ = {};\n  this.jsMimeTypes = \"application/ecmascrip"
    "t application/javascript application/x-ecmascript applicatio"
    "n/x-javascript text/ecmascript text/javascript text/javascri"
    "pt1.0 text/javascript1.1 text/javascript1.2 text/javascript1"
    ".3 text/javascript1.4 text/javascript1.5 text/jscript text/l"
    "ivescript text/x-ecmascript text/x-javascript\".split(\" \");\n "
    " this.overrideDefaultImplementation_ = !0;\n  this.origGetEle"
    "mentById_ = document.getElementById;\n  this.origGetElementsB"
    "yTagName_ = document.getElementsByTagName;\n  this.origDocWri"
    "te_ = document.write;\n  this.origDocOpen_ = document.open;\n "
    " this.origDocClose_ = document.close;\n  this.origDocAddEvent"
    "Listener_ = document.addEventListener;\n  this.origWindowAddE"
    "ventListener_ = window.addEventListener;\n  this.origDocAttac"
    "hEvent_ = document.attachEvent;\n  this.origWindowAttachEvent"
    "_ = window.attachEvent;\n  this.origCreateElement_ = document"
    ".createElement;\n  this.state_ = deferJsNs.DeferJs.STATES.NOT"
    "_STARTED;\n  this.eventState_ = deferJsNs.DeferJs.EVENT.NOT_S"
    "TARTED;\n  this.lastIncrementalRun_ = this.firstIncrementalRu"
    "n_ = !0;\n  this.incrementalScriptsDoneCallback_ = null;\n  th"
    "is.noDeferAsyncScriptsCount_ = 0;\n  this.noDeferAsyncScripts"
    "_ = [];\n  this.psaNotProcessed_ = this.psaScriptType_ = \"\";\n"
    "  this.optLastIndex_ = -1;\n};\ndeferJsNs.DeferJs.isExperiment"
    "alMode = !1;\ndeferJsNs.DeferJs.STATES = {NOT_STARTED:0, WAIT"
    "ING_FOR_NEXT_RUN:1, SCRIPTS_REGISTERED:2, SCRIPTS_EXECUTING:"
    "3, SYNC_SCRIPTS_DONE:4, WAITING_FOR_ONLOAD:5, SCRIPTS_DONE:6"
    "};\ndeferJsNs.DeferJs.EVENT = {NOT_STARTED:0, BEFORE_SCRIPTS:"
    "1, DOM_READY:2, LOAD:3, AFTER_SCRIPTS:4};\ndeferJsNs.DeferJs."
    "PRIORITY_PSA_NOT_PROCESSED = \"priority_psa_not_processed\";\nd"
    "eferJsNs.DeferJs.PSA_NOT_PROCESSED = \"psa_not_processed\";\nde"
    "ferJsNs.DeferJs.PSA_CURRENT_NODE = \"psa_current_node\";\ndefer"
    "JsNs.DeferJs.PSA_TO_BE_DELETED = \"psa_to_be_deleted\";\ndeferJ"
    "sNs.DeferJs.PSA_SCRIPT_TYPE = \"text/psajs\";\ndeferJsNs.DeferJ"
    "s.PRIORITY_PSA_SCRIPT_TYPE = \"text/prioritypsajs\";\ndeferJsNs"
    ".DeferJs.PSA_ORIG_TYPE = \"data-pagespeed-orig-type\";\ndeferJs"
    "Ns.DeferJs.PSA_ORIG_SRC = \"data-pagespeed-orig-src\";\ndeferJs"
    "Ns.DeferJs.PSA_ORIG_INDEX = \"data-pagespeed-orig-index\";\ndef"
    "erJsNs.DeferJs.PAGESPEED_ONLOAD = \"data-pagespeed-onload\";\nd"
    "eferJsNs.DeferJs.prototype.log = function(a, b) {\n  this.log"
    "s && (this.logs.push(\"\" + a), b && (this.logs.push(b.message"
    "), \"undefined\" != typeof console && \"undefined\" != typeof co"
    "nsole.log && console.log(\"PSA ERROR: \" + a + b.message)));\n}"
    ";\ndeferJsNs.DeferJs.prototype.submitTask = function(a, b) {\n"
    "  this.queue_.splice(b ? b : this.queue_.length, 0, a);\n};\nd"
    "eferJsNs.DeferJs.prototype.globalEval = function(a, b) {\n  v"
    "ar d = this.cloneScriptNode(b);\n  d.text = a;\n  d.setAttribu"
    "te(\"type\", \"text/javascript\");\n  var c = this.getCurrentDomL"
    "ocation();\n  c.parentNode.insertBefore(d, c);\n  return d;\n};"
    "\ndeferJsNs.DeferJs.prototype.createIdVars = function() {\n  f"
    "or (var a = document.getElementsByTagName(\"*\"), b = \"\", d = "
    "0;d < a.length;d++) {\n    if (a[d].hasAttribute(\"id\")) {\n   "
    "   var c = a[d].getAttribute(\"id\");\n      if (c && -1 == c.s"
    "earch(/[-:.]/) && -1 == c.search(/^[0-9]/)) {\n        try {\n"
    "          window[c] && window[c].tagName && (b += \"var \" + c"
    " + \'=document.getElementById(\"\' + c + \'\");\');\n        } catc"
    "h (g) {\n          this.log(\"Exception while evaluating.\", g)"
    ";\n        }\n      }\n    }\n  }\n  b && (a = this.globalEval(b)"
    ", a.setAttribute(deferJsNs.DeferJs.PSA_NOT_PROCESSED, \"\"), a"
    ".setAttribute(deferJsNs.DeferJs.PRIORITY_PSA_NOT_PROCESSED, "
    "\"\"));\n};\ndeferJsNs.DeferJs.prototype.attemptPrefetchOrQueue "
    "= function(a) {\n  var b = this.origCreateElement_.call(docum"
    "ent, \"link\");\n  b.setAttribute(\"rel\", \"preload\");\n  b.setAtt"
    "ribute(\"as\", \"script\");\n  b.setAttribute(\"href\", a);\n  docum"
    "ent.head.appendChild(b);\n};\ndeferJsNs.DeferJs.prototype.addN"
    "ode = function(a, b, d) {\n  var c = a.getAttribute(deferJsNs"
    ".DeferJs.PSA_ORIG_SRC) || a.getAttribute(\"src\");\n  c ? (d &&"
    " this.attemptPrefetchOrQueue(c), this.addUrl(c, a, b)) : thi"
    "s.addStr(a.innerHTML || a.textContent || a.data || \"\", a, b)"
    ";\n};\ndeferJsNs.DeferJs.prototype.addStr = function(a, b, d) "
    "{\n  if (this.isFireFox()) {\n    this.addUrl(\"data:text/javas"
    "cript,\" + encodeURIComponent(a), b, d);\n  } else {\n    this."
    "logs.push(\"Add to queue str: \" + a);\n    var c = this;\n    t"
    "his.submitTask(function() {\n      c.removeNotProcessedAttrib"
    "uteTillNode(b);\n      c.nextPsaJsNode().setAttribute(deferJs"
    "Ns.DeferJs.PSA_CURRENT_NODE, \"\");\n      try {\n        c.glob"
    "alEval(a, b);\n      } catch (g) {\n        c.log(\"Exception w"
    "hile evaluating.\", g);\n      }\n      c.log(\"Evaluated: \" + a"
    ");\n      c.runNext();\n    }, d);\n  }\n};\ndeferJsNs.DeferJs.pr"
    "ototype.addStr = deferJsNs.DeferJs.prototype.addStr;\ndeferJs"
    "Ns.DeferJs.prototype.cloneScriptNode = function(a) {\n  var b"
    " = this.origCreateElement_.call(document, \"script\");\n  if (a"
    ") {\n    for (var d = a.attributes, c = d.length - 1;0 <= c;-"
    "-c) {\n      \"type\" != d[c].name && \"src\" != d[c].name && \"as"
    "ync\" != d[c].name && \"defer\" != d[c].name && d[c].name != de"
    "ferJsNs.DeferJs.PSA_ORIG_TYPE && d[c].name != deferJsNs.Defe"
    "rJs.PSA_ORIG_SRC && d[c].name != deferJsNs.DeferJs.PSA_ORIG_"
    "INDEX && d[c].name != deferJsNs.DeferJs.PSA_CURRENT_NODE && "
    "d[c].name != this.psaNotProcessed_ && (b.setAttribute(d[c].n"
    "ame, d[c].value), a.removeAttribute(d[c].name));\n    }\n  }\n "
    " return b;\n};\ndeferJsNs.DeferJs.prototype.scriptOnLoad = fun"
    "ction(a) {\n  var b = this.origCreateElement_.call(document, "
    "\"script\");\n  b.setAttribute(\"type\", \"text/javascript\");\n  b."
    "async = !1;\n  b.setAttribute(deferJsNs.DeferJs.PSA_TO_BE_DEL"
    "ETED, \"\");\n  b.setAttribute(deferJsNs.DeferJs.PSA_NOT_PROCES"
    "SED, \"\");\n  b.setAttribute(deferJsNs.DeferJs.PRIORITY_PSA_NO"
    "T_PROCESSED, \"\");\n  var d = this, c = function() {\n    if (d"
    "ocument.querySelector) {\n      var b = document.querySelecto"
    "r(\"[\" + deferJsNs.DeferJs.PSA_TO_BE_DELETED + \"]\");\n      b "
    "&& b.parentNode.removeChild(b);\n    }\n    d.log(\"Executed: \""
    " + a);\n    d.runNext();\n  };\n  deferJsNs.addOnload(b, c);\n  "
    "pagespeedutils.addHandler(b, \"error\", c);\n  b.src = \"data:te"
    "xt/javascript,\" + encodeURIComponent(\"window.pagespeed.psate"
    "mp=0;\");\n  c = this.getCurrentDomLocation();\n  c.parentNode."
    "insertBefore(b, c);\n};\ndeferJsNs.DeferJs.prototype.addUrl = "
    "function(a, b, d) {\n  this.logs.push(\"Add to queue url: \" + "
    "a);\n  var c = this;\n  this.submitTask(function() {\n    c.rem"
    "oveNotProcessedAttributeTillNode(b);\n    var d = c.cloneScri"
    "ptNode(b);\n    d.setAttribute(\"type\", \"text/javascript\");\n  "
    "  var e = !0;\n    \"async\" in d ? d.async = !1 : d.readyState"
    " && (e = !1, pagespeedutils.addHandler(d, \"readystatechange\""
    ", function() {\n      if (\"complete\" == d.readyState || \"load"
    "ed\" == d.readyState) {\n        d.onreadystatechange = null, "
    "c.log(\"Executed: \" + a), c.runNext();\n      }\n    }));\n    d"
    ".setAttribute(\"src\", a);\n    var f = b.innerHTML || b.textCo"
    "ntent || b.data;\n    f && d.appendChild(document.createTextN"
    "ode(f));\n    f = c.nextPsaJsNode();\n    f.setAttribute(defer"
    "JsNs.DeferJs.PSA_CURRENT_NODE, \"\");\n    f.parentNode.insertB"
    "efore(d, f);\n    e && c.scriptOnLoad(a);\n  }, d);\n};\ndeferJs"
    "Ns.DeferJs.prototype.addUrl = deferJsNs.DeferJs.prototype.ad"
    "dUrl;\ndeferJsNs.DeferJs.prototype.removeNotProcessedAttribut"
    "eTillNode = function(a) {\n  if (document.querySelectorAll &&"
    " !(8 >= this.getIEVersion())) {\n    for (var b = document.qu"
    "erySelectorAll(\"[\" + this.psaNotProcessed_ + \"]\"), d = 0;d <"
    " b.length;d++) {\n      var c = b.item(d);\n      if (c == a) "
    "{\n        break;\n      }\n      c.getAttribute(\"type\") != thi"
    "s.psaScriptType_ && c.removeAttribute(this.psaNotProcessed_)"
    ";\n    }\n  }\n};\ndeferJsNs.DeferJs.prototype.setNotProcessedAt"
    "tributeForNodes = function() {\n  for (var a = this.origGetEl"
    "ementsByTagName_.call(document, \"*\"), b = 0;b < a.length;b++"
    ") {\n    a.item(b).setAttribute(this.psaNotProcessed_, \"\");\n "
    " }\n};\ndeferJsNs.DeferJs.prototype.nextPsaJsNode = function()"
    " {\n  var a = null;\n  document.querySelector && (a = document"
    ".querySelector(\'[type=\"\' + this.psaScriptType_ + \'\"]\'));\n  r"
    "eturn a;\n};\ndeferJsNs.DeferJs.prototype.getCurrentDomLocatio"
    "n = function() {\n  var a;\n  document.querySelector && (a = d"
    "ocument.querySelector(\"[\" + deferJsNs.DeferJs.PSA_CURRENT_NO"
    "DE + \"]\"));\n  return a || this.origGetElementsByTagName_.cal"
    "l(document, \"psanode\")[0];\n};\ndeferJsNs.DeferJs.prototype.re"
    "moveCurrentDomLocation = function() {\n  var a = this.getCurr"
    "entDomLocation();\n  \"SCRIPT\" == a.nodeName && a.parentNode.r"
    "emoveChild(a);\n};\ndeferJsNs.DeferJs.prototype.onComplete = f"
    "unction() {\n  if (!(this.state_ >= deferJsNs.DeferJs.STATES."
    "WAITING_FOR_ONLOAD)) {\n    if (this.lastIncrementalRun_ && t"
    "his.isLowPriorityDeferJs() && (this.getIEVersion() && docume"
    "nt.documentElement.originalDoScroll && (document.documentEle"
    "ment.doScroll = document.documentElement.originalDoScroll), "
    "Object.defineProperty && delete document.readyState, this.ge"
    "tIEVersion() && Object.defineProperty && delete document.all"
    "), this.overrideDefaultImplementation_ = !1, this.lastIncrem"
    "entalRun_) {\n      if (this.state_ = deferJsNs.DeferJs.STATE"
    "S.WAITING_FOR_ONLOAD, this.isLowPriorityDeferJs()) {\n       "
    " var a = this;\n        \"complete\" != document.readyState ? d"
    "eferJsNs.addOnload(window, function() {\n          a.fireOnlo"
    "ad();\n        }) : (document.onreadystatechange && this.exec"
    "(document.onreadystatechange, document), window.onload && (p"
    "saAddEventListener(window, \"onload\", window.onload), window."
    "onload = null), this.fireOnload());\n      } else {\n        t"
    "his.highPriorityFinalize();\n      }\n    } else {\n      this."
    "state_ = deferJsNs.DeferJs.STATES.WAITING_FOR_NEXT_RUN, this"
    ".firstIncrementalRun_ = !1, this.incrementalScriptsDoneCallb"
    "ack_ && this.isLowPriorityDeferJs() ? (pagespeed.deferJs = p"
    "agespeed.highPriorityDeferJs, pagespeed.deferJs = pagespeed."
    "highPriorityDeferJs, this.exec(this.incrementalScriptsDoneCa"
    "llback_), this.incrementalScriptsDoneCallback_ = null) : thi"
    "s.highPriorityFinalize();\n    }\n  }\n};\ndeferJsNs.DeferJs.pro"
    "totype.fireOnload = function() {\n  this.isLowPriorityDeferJs"
    "() && (this.addDeferredOnloadListeners(), pagespeed.highPrio"
    "rityDeferJs.fireOnload());\n  this.fireEvent(deferJsNs.DeferJ"
    "s.EVENT.LOAD);\n  if (this.isLowPriorityDeferJs()) {\n    for "
    "(var a = document.body.getElementsByTagName(\"psanode\"), b = "
    "a.length - 1;0 <= b;b--) {\n      document.body.removeChild(a"
    "[b]);\n    }\n    a = document.body.getElementsByClassName(\"ps"
    "a_prefetch_container\");\n    for (b = a.length - 1;0 <= b;b--"
    ") {\n      a[b].parentNode.removeChild(a[b]);\n    }\n  }\n  thi"
    "s.state_ = deferJsNs.DeferJs.STATES.SCRIPTS_DONE;\n  this.fir"
    "eEvent(deferJsNs.DeferJs.EVENT.AFTER_SCRIPTS);\n};\ndeferJsNs."
    "DeferJs.prototype.highPriorityFinalize = function() {\n  var "
    "a = this;\n  window.setTimeout(function() {\n    pagespeed.def"
    "erJs = pagespeed.lowPriorityDeferJs;\n    pagespeed.deferJs ="
    " pagespeed.lowPriorityDeferJs;\n    a.incrementalScriptsDoneC"
    "allback_ ? (pagespeed.deferJs.registerScriptTags(a.increment"
    "alScriptsDoneCallback_, a.optLastIndex_), a.incrementalScrip"
    "tsDoneCallback_ = null) : pagespeed.deferJs.registerScriptTa"
    "gs();\n    pagespeed.deferJs.execute();\n  }, 0);\n};\ndeferJsNs"
    ".DeferJs.prototype.checkNodeInDom = function(a) {\n  for (;a "
    "= a.parentNode;) {\n    if (a == document) {\n      return !0;"
    "\n    }\n  }\n  return !1;\n};\ndeferJsNs.DeferJs.prototype.getNu"
    "mScriptsWithNoOnload = function(a) {\n  for (var b = 0, d = a"
    ".length, c = 0;c < d;++c) {\n    var g = a[c], e = g.parentNo"
    "de, f = g.src, h = g.textContent;\n    (8 < this.getIEVersion"
    "() && (!e || \"\" == f && \"\" == h) || !(this.getIEVersion() ||"
    " this.checkNodeInDom(g) && \"\" != f)) && b++;\n  }\n  return b;"
    "\n};\ndeferJsNs.DeferJs.prototype.canCallOnComplete = function"
    "() {\n  if (this.state_ != deferJsNs.DeferJs.STATES.SYNC_SCRI"
    "PTS_DONE) {\n    return !1;\n  }\n  var a = 0;\n  0 != this.dyna"
    "micInsertedScriptCount_ && (a = this.getNumScriptsWithNoOnlo"
    "ad(this.dynamicInsertedScript_));\n  return this.dynamicInser"
    "tedScriptCount_ == a ? !0 : !1;\n};\ndeferJsNs.DeferJs.prototy"
    "pe.scriptsAreDone = function() {\n  return this.state_ === de"
    "ferJsNs.DeferJs.STATES.SCRIPTS_DONE;\n};\ndeferJsNs.DeferJs.pr"
    "ototype.scriptsAreDone = deferJsNs.DeferJs.prototype.scripts"
    "AreDone;\ndeferJsNs.DeferJs.prototype.runNext = function() {\n"
    "  this.handlePendingDocumentWrites();\n  this.removeCurrentDo"
    "mLocation();\n  if (this.next_ < this.queue_.length) {\n    th"
    "is.next_++, this.queue_[this.next_ - 1].call(window);\n  } el"
    "se {\n    if (this.lastIncrementalRun_) {\n      if (this.stat"
    "e_ = deferJsNs.DeferJs.STATES.SYNC_SCRIPTS_DONE, this.remove"
    "NotProcessedAttributeTillNode(), this.fireEvent(deferJsNs.De"
    "ferJs.EVENT.DOM_READY), this.canCallOnComplete()) {\n        "
    "this.onComplete();\n      }\n    } else {\n      this.onComplet"
    "e();\n    }\n  }\n};\ndeferJsNs.DeferJs.prototype.nodeListToArra"
    "y = function(a) {\n  for (var b = [], d = a.length, c = 0;c <"
    " d;++c) {\n    b.push(a.item(c));\n  }\n  return b;\n};\ndeferJsN"
    "s.DeferJs.prototype.setUp = function() {\n  var a = this;\n  i"
    "f (this.firstIncrementalRun_ && !this.isLowPriorityDeferJs()"
    ") {\n    var b = document.createElement(\"psanode\");\n    b.set"
    "Attribute(\"psa_dw_target\", \"true\");\n    document.body.append"
    "Child(b);\n    this.getIEVersion() && this.createIdVars();\n  "
    "  if (Object.defineProperty) {\n      try {\n        var d = {"
    "configurable:!0, get:function() {\n          return a.state_ "
    ">= deferJsNs.DeferJs.STATES.SYNC_SCRIPTS_DONE ? \"interactive"
    "\" : \"loading\";\n        }};\n        Object.defineProperty(doc"
    "ument, \"readyState\", d);\n      } catch (c) {\n        this.lo"
    "g(\"Exception while overriding document.readyState.\", c);\n   "
    "   }\n    }\n    if (this.getIEVersion() && (document.document"
    "Element.originalDoScroll = document.documentElement.doScroll"
    ", document.documentElement.doScroll = function() {\n      thr"
    "ow \"psa exception\";\n    }, Object.defineProperty)) {\n      t"
    "ry {\n        d = {configurable:!0, get:function() {\n        "
    "}}, Object.defineProperty(document, \"all\", d);\n      } catch"
    " (c) {\n        this.log(\"Exception while overriding document"
    ".all.\", c);\n      }\n    }\n  }\n  this.overrideAddEventListene"
    "rs();\n  document.writeln = function(b) {\n    a.writeHtml(b +"
    " \"\\n\");\n  };\n  document.write = function(b) {\n    a.writeHtm"
    "l(b);\n  };\n  document.open = function() {\n    a.overrideDefa"
    "ultImplementation_ || a.origDocOpen_.call(document);\n  };\n  "
    "document.close = function() {\n    a.overrideDefaultImplement"
    "ation_ || a.origDocClose_.call(document);\n  };\n  document.ge"
    "tElementById = function(b) {\n    a.handlePendingDocumentWrit"
    "es();\n    b = a.origGetElementById_.call(document, b);\n    r"
    "eturn null == b || b.hasAttribute(a.psaNotProcessed_) ? null"
    " : b;\n  };\n  !document.querySelectorAll || 8 >= a.getIEVersi"
    "on() || (document.getElementsByTagName = function(b) {\n    i"
    "f (a.overrideDefaultImplementation_) {\n      try {\n        r"
    "eturn document.querySelectorAll(b + \":not([\" + a.psaNotProce"
    "ssed_ + \"])\");\n      } catch (g) {\n      }\n    }\n    return "
    "a.origGetElementsByTagName_.call(document, b);\n  });\n  docum"
    "ent.createElement = function(b) {\n    var c = a.origCreateEl"
    "ement_.call(document, b);\n    a.overrideDefaultImplementatio"
    "n_ && \"script\" == b.toLowerCase() && (a.dynamicInsertedScrip"
    "t_.push(c), a.dynamicInsertedScriptCount_++, b = function() "
    "{\n      a.dynamicInsertedScriptCount_--;\n      var b = a.dyn"
    "amicInsertedScript_.indexOf(this);\n      if (-1 != b && (a.d"
    "ynamicInsertedScript_.splice(b, 1), a.canCallOnComplete())) "
    "{\n        a.onComplete();\n      }\n    }, deferJsNs.addOnload"
    "(c, b), pagespeedutils.addHandler(c, \"error\", b));\n    retur"
    "n c;\n  };\n};\ndeferJsNs.DeferJs.prototype.execute = function("
    ") {\n  if (this.state_ == deferJsNs.DeferJs.STATES.SCRIPTS_RE"
    "GISTERED) {\n    var a = 0;\n    0 != this.noDeferAsyncScripts"
    "Count_ && (a = this.getNumScriptsWithNoOnload(this.noDeferAs"
    "yncScripts_));\n    this.noDeferAsyncScriptsCount_ == a && th"
    "is.run();\n  }\n};\ndeferJsNs.DeferJs.prototype.execute = defer"
    "JsNs.DeferJs.prototype.execute;\ndeferJsNs.DeferJs.prototype."
    "run = function() {\n  this.state_ == deferJsNs.DeferJs.STATES"
    ".SCRIPTS_REGISTERED && (this.firstIncrementalRun_ && this.fi"
    "reEvent(deferJsNs.DeferJs.EVENT.BEFORE_SCRIPTS), this.state_"
    " = deferJsNs.DeferJs.STATES.SCRIPTS_EXECUTING, this.setUp(),"
    " this.runNext());\n};\ndeferJsNs.DeferJs.prototype.run = defer"
    "JsNs.DeferJs.prototype.run;\ndeferJsNs.DeferJs.prototype.pars"
    "eHtml = function(a) {\n  var b = this.origCreateElement_.call"
    "(document, \"div\");\n  b.innerHTML = \"<div>_</div>\" + a;\n  b.r"
    "emoveChild(b.firstChild);\n  return b;\n};\ndeferJsNs.DeferJs.p"
    "rototype.disown = function(a) {\n  var b = a.parentNode;\n  b "
    "&& b.removeChild(a);\n};\ndeferJsNs.DeferJs.prototype.insertNo"
    "desBeforeElem = function(a, b) {\n  for (var d = this.nodeLis"
    "tToArray(a), c = d.length, g = b.parentNode, e = 0;e < c;++e"
    ") {\n    var f = d[e];\n    this.disown(f);\n    g.insertBefore"
    "(f, b);\n  }\n};\ndeferJsNs.DeferJs.prototype.isJSNode = functi"
    "on(a) {\n  return \"SCRIPT\" != a.nodeName ? !1 : a.hasAttribut"
    "e(\"type\") ? (a = a.getAttribute(\"type\"), !a || -1 != this.js"
    "MimeTypes.indexOf(a)) : a.hasAttribute(\"language\") ? (a = a."
    "getAttribute(\"language\"), !a || -1 != this.jsMimeTypes.index"
    "Of(\"text/\" + a.toLowerCase())) : !0;\n};\ndeferJsNs.DeferJs.pr"
    "ototype.markNodesAndExtractScriptNodes = function(a, b) {\n  "
    "if (a.childNodes) {\n    for (var d = this.nodeListToArray(a."
    "childNodes), c = d.length, g = 0;g < c;++g) {\n      var e = "
    "d[g];\n      \"SCRIPT\" == e.nodeName ? this.isJSNode(e) && (b."
    "push(e), e.setAttribute(deferJsNs.DeferJs.PSA_ORIG_TYPE, e.t"
    "ype), e.setAttribute(\"type\", this.psaScriptType_), e.setAttr"
    "ibute(deferJsNs.DeferJs.PSA_ORIG_SRC, e.src), e.setAttribute"
    "(\"src\", \"\"), e.setAttribute(this.psaNotProcessed_, \"\")) : th"
    "is.markNodesAndExtractScriptNodes(e, b);\n    }\n  }\n};\ndeferJ"
    "sNs.DeferJs.prototype.deferScripts = function(a, b) {\n  for "
    "(var d = a.length, c = 0;c < d;++c) {\n    this.addNode(a[c],"
    " b + c, !!c);\n  }\n};\ndeferJsNs.DeferJs.prototype.insertHtml "
    "= function(a, b, d) {\n  a = this.parseHtml(a);\n  var c = [];"
    "\n  this.markNodesAndExtractScriptNodes(a, c);\n  d ? this.ins"
    "ertNodesBeforeElem(a.childNodes, d) : this.log(\"Unable to in"
    "sert nodes, no context element found\");\n  this.deferScripts("
    "c, b);\n};\ndeferJsNs.DeferJs.prototype.handlePendingDocumentW"
    "rites = function() {\n  if (\"\" != this.documentWriteHtml_) {\n"
    "    this.log(\"handle_dw: \" + this.documentWriteHtml_);\n    v"
    "ar a = this.documentWriteHtml_;\n    this.documentWriteHtml_ "
    "= \"\";\n    var b = this.getCurrentDomLocation();\n    this.ins"
    "ertHtml(a, this.next_, b);\n  }\n};\ndeferJsNs.DeferJs.prototyp"
    "e.writeHtml = function(a) {\n  this.overrideDefaultImplementa"
    "tion_ ? (this.log(\"dw: \" + a), this.documentWriteHtml_ += a)"
    " : this.origDocWrite_.call(document, a);\n};\ndeferJsNs.DeferJ"
    "s.prototype.addDeferredOnloadListeners = function() {\n  var "
    "a;\n  document.querySelectorAll && (a = document.querySelecto"
    "rAll(\"[\" + deferJsNs.DeferJs.PAGESPEED_ONLOAD + \"][data-page"
    "speed-loaded]\"));\n  for (var b = 0;b < a.length;b++) {\n    v"
    "ar d = a.item(b), c = \"var psaFunc=function() {\" + d.getAttr"
    "ibute(deferJsNs.DeferJs.PAGESPEED_ONLOAD) + \"};\";\n    window"
    ".eval.call(window, c);\n    \"function\" != typeof window.psaFu"
    "nc ? this.log(\"Function is not defined\", Error(\"\")) : psaAdd"
    "EventListener(d, \"onload\", window.psaFunc);\n  }\n};\ndeferJsNs"
    ".DeferJs.prototype.addBeforeDeferRunFunctions = function(a) "
    "{\n  psaAddEventListener(window, \"onbeforescripts\", a);\n};\nde"
    "ferJsNs.DeferJs.prototype.addBeforeDeferRunFunctions = defer"
    "JsNs.DeferJs.prototype.addBeforeDeferRunFunctions;\ndeferJsNs"
    ".DeferJs.prototype.addAfterDeferRunFunctions = function(a) {"
    "\n  psaAddEventListener(window, \"onafterscripts\", a);\n};\ndefe"
    "rJsNs.DeferJs.prototype.addAfterDeferRunFunctions = deferJsN"
    "s.DeferJs.prototype.addAfterDeferRunFunctions;\ndeferJsNs.Def"
    "erJs.prototype.fireEvent = function(a) {\n  this.eventState_ "
    "= a;\n  this.log(\"Firing Event: \" + a);\n  a = this.eventListe"
    "nersMap_[a] || [];\n  for (var b = 0;b < a.length;++b) {\n    "
    "this.exec(a[b]);\n  }\n  a.length = 0;\n};\ndeferJsNs.DeferJs.pr"
    "ototype.exec = function(a, b) {\n  try {\n    a.call(b || wind"
    "ow);\n  } catch (d) {\n    this.log(\"Exception while evaluatin"
    "g.\", d);\n  }\n};\ndeferJsNs.DeferJs.prototype.overrideAddEvent"
    "Listeners = function() {\n  var a = this;\n  window.addEventLi"
    "stener ? (document.addEventListener = function(b, d, c) {\n  "
    "  psaAddEventListener(document, b, d, a.origDocAddEventListe"
    "ner_, c);\n  }, window.addEventListener = function(b, d, c) {"
    "\n    psaAddEventListener(window, b, d, a.origWindowAddEventL"
    "istener_, c);\n  }) : window.attachEvent && (document.attachE"
    "vent = function(b, d) {\n    psaAddEventListener(document, b,"
    " d, a.origDocAttachEvent_);\n  }, window.attachEvent = functi"
    "on(b, d) {\n    psaAddEventListener(window, b, d, a.origWindo"
    "wAttachEvent_);\n  });\n};\nvar psaAddEventListener = function("
    "a, b, d, c, g) {\n  var e = pagespeed.deferJs;\n  if (e.state_"
    " >= deferJsNs.DeferJs.STATES.WAITING_FOR_ONLOAD) {\n    if (c"
    ") {\n      c.call(a, b, d, g);\n      return;\n    }\n    if (e."
    "state_ >= deferJsNs.DeferJs.STATES.SCRIPTS_DONE) {\n      ret"
    "urn;\n    }\n  }\n  var f;\n  if (e.eventState_ < deferJsNs.Defe"
    "rJs.EVENT.DOM_READY && (\"DOMContentLoaded\" == b || \"readysta"
    "techange\" == b || \"onDOMContentLoaded\" == b || \"onreadystate"
    "change\" == b)) {\n    b = deferJsNs.DeferJs.EVENT.DOM_READY, "
    "f = \"DOMContentLoaded\";\n  } else {\n    if (e.eventState_ < d"
    "eferJsNs.DeferJs.EVENT.LOAD && (\"load\" == b || \"onload\" == b"
    ")) {\n      b = deferJsNs.DeferJs.EVENT.LOAD, f = \"load\";\n   "
    " } else {\n      if (\"onbeforescripts\" == b) {\n        b = de"
    "ferJsNs.DeferJs.EVENT.BEFORE_SCRIPTS;\n      } else {\n       "
    " if (\"onafterscripts\" == b) {\n          b = deferJsNs.DeferJ"
    "s.EVENT.AFTER_SCRIPTS;\n        } else {\n          c && c.cal"
    "l(a, b, d, g);\n          return;\n        }\n      }\n    }\n  }"
    "\n  e.eventListenersMap_[b] || (e.eventListenersMap_[b] = [])"
    ";\n  e.eventListenersMap_[b].push(function() {\n    var b = {b"
    "ubbles:!1, cancelable:!1, eventPhase:2};\n    b.timeStamp = ("
    "new Date).getTime();\n    b.type = f;\n    b.target = a != win"
    "dow ? a : document;\n    b.currentTarget = a;\n    d.call(a, b"
    ");\n  });\n};\ndeferJsNs.DeferJs.prototype.registerScriptTags ="
    " function(a, b) {\n  if (!(this.state_ >= deferJsNs.DeferJs.S"
    "TATES.SCRIPTS_REGISTERED)) {\n    if (a) {\n      if (!deferJs"
    "Ns.DeferJs.isExperimentalMode) {\n        a();\n        return"
    ";\n      }\n      this.lastIncrementalRun_ = !1;\n      this.in"
    "crementalScriptsDoneCallback_ = a;\n      b && (this.optLastI"
    "ndex_ = b);\n    } else {\n      this.lastIncrementalRun_ = !0"
    ";\n    }\n    this.state_ = deferJsNs.DeferJs.STATES.SCRIPTS_R"
    "EGISTERED;\n    for (var d = document.getElementsByTagName(\"s"
    "cript\"), c = d.length, g = 0;g < c;++g) {\n      var e = this"
    ".queue_.length == this.next_, f = d[g];\n      f.getAttribute"
    "(\"type\") == this.psaScriptType_ && (a ? f.getAttribute(defer"
    "JsNs.DeferJs.PSA_ORIG_INDEX) <= this.optLastIndex_ && this.a"
    "ddNode(f, void 0, !e) : (f.getAttribute(deferJsNs.DeferJs.PS"
    "A_ORIG_INDEX) < this.optLastIndex_ && this.log(\"Executing a "
    "script twice. Orig_Index: \" + f.getAttribute(deferJsNs.Defer"
    "Js.PSA_ORIG_INDEX), Error(\"\")), this.addNode(f, void 0, !e))"
    ");\n    }\n  }\n};\ndeferJsNs.DeferJs.prototype.registerScriptTa"
    "gs = deferJsNs.DeferJs.prototype.registerScriptTags;\ndeferJs"
    "Ns.addOnload = function(a, b) {\n  pagespeedutils.addHandler("
    "a, \"load\", b);\n};\npagespeed.addOnload = deferJsNs.addOnload;"
    "\ndeferJsNs.DeferJs.prototype.isFireFox = function() {\n  retu"
    "rn -1 != navigator.userAgent.indexOf(\"Firefox\");\n};\ndeferJsN"
    "s.DeferJs.prototype.isWebKit = function() {\n  return -1 != n"
    "avigator.userAgent.indexOf(\"AppleWebKit\");\n};\ndeferJsNs.Defe"
    "rJs.prototype.getIEVersion = function() {\n  var a = /(?:MSIE"
    ".(\\d+\\.\\d+))/.exec(navigator.userAgent);\n  return a && a[1] "
    "? document.documentMode || parseFloat(a[1]) : NaN;\n};\ndeferJ"
    "sNs.DeferJs.prototype.setType = function(a) {\n  this.psaScri"
    "ptType_ = a;\n};\ndeferJsNs.DeferJs.prototype.setPsaNotProcess"
    "ed = function(a) {\n  this.psaNotProcessed_ = a;\n};\ndeferJsNs"
    ".DeferJs.prototype.isLowPriorityDeferJs = function() {\n  ret"
    "urn this.psaScriptType_ == deferJsNs.DeferJs.PSA_SCRIPT_TYPE"
    " ? !0 : !1;\n};\ndeferJsNs.DeferJs.prototype.noDeferCreateElem"
    "entOverride = function() {\n  var a = this;\n  document.create"
    "Element = function(b) {\n    var d = a.origCreateElement_.cal"
    "l(document, b);\n    a.overrideDefaultImplementation_ && \"scr"
    "ipt\" == b.toLowerCase() && (a.noDeferAsyncScripts_.push(d), "
    "a.noDeferAsyncScriptsCount_++, b = function() {\n      var b "
    "= a.noDeferAsyncScripts_.indexOf(this);\n      -1 != b && (a."
    "noDeferAsyncScripts_.splice(b, 1), a.noDeferAsyncScriptsCoun"
    "t_--, a.execute());\n    }, deferJsNs.addOnload(d, b), pagesp"
    "eedutils.addHandler(d, \"error\", b));\n    return d;\n  };\n};\nd"
    "eferJsNs.DeferJs.prototype.isExperimentalMode = function() {"
    "\n  return deferJsNs.DeferJs.isExperimentalMode;\n};\ndeferJsNs"
    ".DeferJs.prototype.isExperimentalMode = deferJsNs.DeferJs.pr"
    "ototype.isExperimentalMode;\ndeferJsNs.deferInit = function()"
    " {\n  pagespeed.deferJs || (deferJsNs.DeferJs.isExperimentalM"
    "ode = pagespeed.defer_js_experimental, pagespeed.highPriorit"
    "yDeferJs = new deferJsNs.DeferJs, pagespeed.highPriorityDefe"
    "rJs.setType(deferJsNs.DeferJs.PRIORITY_PSA_SCRIPT_TYPE), pag"
    "espeed.highPriorityDeferJs.setPsaNotProcessed(deferJsNs.Defe"
    "rJs.PRIORITY_PSA_NOT_PROCESSED), pagespeed.highPriorityDefer"
    "Js.setNotProcessedAttributeForNodes(), pagespeed.lowPriority"
    "DeferJs = new deferJsNs.DeferJs, pagespeed.lowPriorityDeferJ"
    "s.setType(deferJsNs.DeferJs.PSA_SCRIPT_TYPE), \n  pagespeed.l"
    "owPriorityDeferJs.setPsaNotProcessed(deferJsNs.DeferJs.PSA_N"
    "OT_PROCESSED), pagespeed.lowPriorityDeferJs.setNotProcessedA"
    "ttributeForNodes(), pagespeed.deferJs = pagespeed.highPriori"
    "tyDeferJs, pagespeed.deferJs.noDeferCreateElementOverride(),"
    " pagespeed.deferJs = pagespeed.deferJs);\n};\ndeferJsNs.deferI"
    "nit();\npagespeed.deferJsStarted = !1;\ndeferJsNs.startDeferJs"
    " = function() {\n  pagespeed.deferJsStarted || (pagespeed.def"
    "erJsStarted = !0, pagespeed.deferJs.registerScriptTags(), pa"
    "gespeed.deferJs.execute());\n};\ndeferJsNs.startDeferJs = defe"
    "rJsNs.startDeferJs;\npagespeedutils.addHandler(document, \"DOM"
    "ContentLoaded\", deferJsNs.startDeferJs);\ndeferJsNs.addOnload"
    "(window, deferJsNs.startDeferJs);\n})();\n";

}  // namespace net_instaweb
