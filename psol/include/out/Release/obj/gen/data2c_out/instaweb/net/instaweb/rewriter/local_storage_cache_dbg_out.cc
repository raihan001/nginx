// Copyright 2011 Google Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// Automatically generated from /usr/src/modpagespeed/out/Release/obj/gen/closure_out/instaweb/rewriter/local_storage_cache_dbg.js

namespace net_instaweb {

const char* JS_local_storage_cache =
    "(function(){var pagespeedutils = {MAX_POST_SIZE:131072, send"
    "Beacon:function(a, b, c) {\n  var d;\n  if (window.XMLHttpRequ"
    "est) {\n    d = new XMLHttpRequest;\n  } else {\n    if (window"
    ".ActiveXObject) {\n      try {\n        d = new ActiveXObject("
    "\"Msxml2.XMLHTTP\");\n      } catch (e) {\n        try {\n       "
    "   d = new ActiveXObject(\"Microsoft.XMLHTTP\");\n        } cat"
    "ch (h) {\n        }\n      }\n    }\n  }\n  if (!d) {\n    return "
    "!1;\n  }\n  var f = -1 == a.indexOf(\"?\") ? \"?\" : \"&\";\n  a = a "
    "+ f + \"url=\" + encodeURIComponent(b);\n  d.open(\"POST\", a);\n "
    " d.setRequestHeader(\"Content-Type\", \"application/x-www-form-"
    "urlencoded\");\n  d.send(c);\n  return !0;\n}, addHandler:functi"
    "on(a, b, c) {\n  if (a.addEventListener) {\n    a.addEventList"
    "ener(b, c, !1);\n  } else {\n    if (a.attachEvent) {\n      a."
    "attachEvent(\"on\" + b, c);\n    } else {\n      var d = a[\"on\" "
    "+ b];\n      a[\"on\" + b] = function() {\n        c.call(this);"
    "\n        d && d.call(this);\n      };\n    }\n  }\n}, getPositio"
    "n:function(a) {\n  for (var b = a.offsetTop, c = a.offsetLeft"
    ";a.offsetParent;) {\n    a = a.offsetParent, b += a.offsetTop"
    ", c += a.offsetLeft;\n  }\n  return {top:b, left:c};\n}, getWin"
    "dowSize:function() {\n  return {height:window.innerHeight || "
    "document.documentElement.clientHeight || document.body.clien"
    "tHeight, width:window.innerWidth || document.documentElement"
    ".clientWidth || document.body.clientWidth};\n}, inViewport:fu"
    "nction(a, b) {\n  var c = pagespeedutils.getPosition(a);\n  re"
    "turn pagespeedutils.positionInViewport(c, b);\n}, positionInV"
    "iewport:function(a, b) {\n  return a.top < b.height && a.left"
    " < b.width;\n}, getRequestAnimationFrame:function() {\n  retur"
    "n window.requestAnimationFrame || window.webkitRequestAnimat"
    "ionFrame || window.mozRequestAnimationFrame || window.oReque"
    "stAnimationFrame || window.msRequestAnimationFrame || null;\n"
    "}};\npagespeedutils.now = Date.now || function() {\n  return +"
    "new Date;\n};\nwindow.pagespeed = window.pagespeed || {};\nvar "
    "pagespeed = window.pagespeed;\npagespeed.LocalStorageCache = "
    "function() {\n  this.regenerate_cookie_ = !0;\n};\npagespeed.Lo"
    "calStorageCache.prototype.hasExpired = function(a) {\n  a = p"
    "arseInt(a.substring(0, a.indexOf(\" \")), 10);\n  return !isNaN"
    "(a) && a <= pagespeedutils.now();\n};\npagespeed.LocalStorageC"
    "ache.prototype.hasExpired = pagespeed.LocalStorageCache.prot"
    "otype.hasExpired;\npagespeed.LocalStorageCache.prototype.getD"
    "ata = function(a) {\n  var b = a.indexOf(\" \"), b = a.indexOf("
    "\" \", b + 1);\n  return a.substring(b + 1);\n};\npagespeed.Local"
    "StorageCache.prototype.getData = pagespeed.LocalStorageCache"
    ".prototype.getData;\npagespeed.LocalStorageCache.prototype.re"
    "placeLastScript = function(a) {\n  var b = document.getElemen"
    "tsByTagName(\"script\"), b = b[b.length - 1];\n  b.parentNode.r"
    "eplaceChild(a, b);\n};\npagespeed.LocalStorageCache.prototype."
    "replaceLastScript = pagespeed.LocalStorageCache.prototype.re"
    "placeLastScript;\npagespeed.LocalStorageCache.prototype.inlin"
    "eCss = function(a) {\n  var b = window.localStorage.getItem(\""
    "pagespeed_lsc_url:\" + a), c = document.createElement(b ? \"st"
    "yle\" : \"link\");\n  b && !this.hasExpired(b) ? (c.type = \"text"
    "/css\", c.appendChild(document.createTextNode(this.getData(b)"
    "))) : (c.rel = \"stylesheet\", c.href = a, this.regenerate_coo"
    "kie_ = !0);\n  this.replaceLastScript(c);\n};\npagespeed.LocalS"
    "torageCache.prototype.inlineCss = pagespeed.LocalStorageCach"
    "e.prototype.inlineCss;\npagespeed.LocalStorageCache.prototype"
    ".inlineImg = function(a, b) {\n  var c = window.localStorage."
    "getItem(\"pagespeed_lsc_url:\" + a + \" pagespeed_lsc_hash:\" + "
    "b), d = document.createElement(\"img\");\n  c && !this.hasExpir"
    "ed(c) ? d.src = this.getData(c) : (d.src = a, this.regenerat"
    "e_cookie_ = !0);\n  for (var c = 2, f = arguments.length;c < "
    "f;++c) {\n    var e = arguments[c].indexOf(\"=\");\n    d.setAtt"
    "ribute(arguments[c].substring(0, e), arguments[c].substring("
    "e + 1));\n  }\n  this.replaceLastScript(d);\n};\npagespeed.Local"
    "StorageCache.prototype.inlineImg = pagespeed.LocalStorageCac"
    "he.prototype.inlineImg;\npagespeed.LocalStorageCache.prototyp"
    "e.processTags_ = function(a, b, c) {\n  a = document.getEleme"
    "ntsByTagName(a);\n  for (var d = 0, f = a.length;d < f;++d) {"
    "\n    var e = a[d], h = e.getAttribute(\"data-pagespeed-lsc-ha"
    "sh\"), g = e.getAttribute(\"data-pagespeed-lsc-url\");\n    if ("
    "h && g) {\n      g = \"pagespeed_lsc_url:\" + g;\n      b && (g "
    "+= \" pagespeed_lsc_hash:\" + h);\n      var k = e.getAttribute"
    "(\"data-pagespeed-lsc-expiry\"), k = k ? (new Date(k)).getTime"
    "() : \"\", e = c(e);\n      if (!e) {\n        var l = window.lo"
    "calStorage.getItem(g);\n        l && (e = this.getData(l));\n "
    "     }\n      e && (window.localStorage.setItem(g, k + \" \" + "
    "h + \" \" + e), this.regenerate_cookie_ = !0);\n    }\n  }\n};\npa"
    "gespeed.LocalStorageCache.prototype.saveInlinedData_ = funct"
    "ion() {\n  this.processTags_(\"img\", !0, function(a) {\n    ret"
    "urn a.src;\n  });\n  this.processTags_(\"style\", !1, function(a"
    ") {\n    return a.firstChild ? a.firstChild.nodeValue : null;"
    "\n  });\n};\npagespeed.LocalStorageCache.prototype.generateCook"
    "ie_ = function() {\n  if (this.regenerate_cookie_) {\n    for "
    "(var a = [], b = [], c = 0, d = pagespeedutils.now(), f = 0,"
    " e = window.localStorage.length;f < e;++f) {\n      var h = w"
    "indow.localStorage.key(f);\n      if (!h.indexOf(\"pagespeed_l"
    "sc_url:\")) {\n        var g = window.localStorage.getItem(h),"
    " k = g.indexOf(\" \"), l = parseInt(g.substring(0, k), 10);\n  "
    "      if (!isNaN(l)) {\n          if (l <= d) {\n            a"
    ".push(h);\n            continue;\n          } else {\n         "
    "   if (l < c || 0 == c) {\n              c = l;\n            }"
    "\n          }\n        }\n        h = g.indexOf(\" \", k + 1);\n  "
    "      g = g.substring(k + 1, h);\n        b.push(g);\n      }\n"
    "    }\n    d = \"\";\n    c && (d = \"; expires=\" + (new Date(c))"
    ".toUTCString());\n    document.cookie = \"_GPSLSC=\" + b.join(\""
    "!\") + d;\n    f = 0;\n    for (e = a.length;f < e;++f) {\n     "
    " window.localStorage.removeItem(a[f]);\n    }\n    this.regene"
    "rate_cookie_ = !1;\n  }\n};\npagespeed.localStorageCacheInit = "
    "function() {\n  if (window.localStorage) {\n    var a = new pa"
    "gespeed.LocalStorageCache;\n    pagespeed.localStorageCache ="
    " a;\n    pagespeedutils.addHandler(window, \"load\", function()"
    " {\n      a.saveInlinedData_();\n    });\n    pagespeedutils.ad"
    "dHandler(window, \"load\", function() {\n      a.generateCookie"
    "_();\n    });\n  }\n};\npagespeed.localStorageCacheInit = pagesp"
    "eed.localStorageCacheInit;\n})();\n";

}  // namespace net_instaweb
